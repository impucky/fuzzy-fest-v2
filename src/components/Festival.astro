---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";

import { getBandNamesFromSlugs } from "../utils/content";
import { formatFestivalDates } from "../utils/dates";

import type { Festival } from "../content.config";
import type { ImageMetadata } from "astro";

const festival: Festival = Astro.props.festival;
const { name, website, country, city, indoor, startDate, endDate, lineup, img } = festival;
const bands = lineup ? await getBandNamesFromSlugs(lineup) : null;
const year = new Date(startDate).getFullYear();
---

<section class="flex flex-col items-center text-center text-white">
  <div class="absolute top-0 right-0 z-[1] p-2 pr-3 lg:p-4 lg:pr-5">
    <a href={`/${year}`}
      ><Icon name="close" class="text-3xl text-neutral-400 transition hover:text-white" /></a
    >
  </div>
  {
    img && (
      <Image
        src={img}
        alt={name + " logo"}
        class="mt-8 h-auto max-h-20 w-auto max-w-64 md:max-h-32 lg:max-w-80 xl:max-w-full"
      />
    )
  }
  <h2 class="mt-3 text-xl sm:text-2xl">{name}</h2>

  <div class="mt-4 flex items-center gap-1 text-center">
    <Icon name="pin" class="text-xl" />
    <h3 class="text-lg">{city}, {country}</h3>
  </div>

  <div class="flex items-center gap-1 text-center">
    <Icon name="calendar" class="text-xl" />
    <p>{formatFestivalDates(startDate, endDate)}</p>
  </div>

  <div class="flex items-center gap-1 text-center">
    <Icon name={indoor ? "building" : "tent"} class="text-xl" />
    <p>{indoor ? "Indoor" : "Open-air"}</p>
  </div>

  <div class="mt-3 flex items-center gap-1 text-center">
    <Icon name="link" class="text-xl" />
    <a
      href={website}
      target="_blank"
      class="cursor-pointer text-xl text-[salmon] underline transition hover:text-white"
    >
      homepage
    </a>
  </div>

  <h3 class="mt-4 text-xl font-bold text-neutral-300">- Lineup -</h3>
  <ul class="flex w-full flex-col flex-wrap">
    {
      bands
        ? bands.map((band) => {
            return (
              <li class="text-md leading-snug font-black sm:text-xl md:text-2xl">{band.toUpperCase()}</li>
            );
          })
        : "To be announced"
    }
  </ul>
</section>
